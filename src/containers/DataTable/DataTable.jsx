
import React, { useEffect, useState } from 'react';
import { initializeApp } from 'firebase/app';
import './DataTable.css';
import { getDatabase, ref, onValue, off, orderByChild, startAt, endAt } from 'firebase/database';

// Initialize Firebase
const firebaseConfig = {

    apiKey: "AIzaSyDzuobEE2QMZvNHViGGcSF_O3KwhYP_Ho4",
  
    authDomain: "test-36b79.firebaseapp.com",
  
    databaseURL: "https://test-36b79-default-rtdb.firebaseio.com",
  
    projectId: "test-36b79",
  
    storageBucket: "test-36b79.appspot.com",
  
    messagingSenderId: "861846156224",
  
    appId: "1:861846156224:web:c89f1bf833011492d08e25",
  
    measurementId: "G-3EESY7N6LF"
  
  };
  

initializeApp(firebaseConfig);

const DataTable = () => {
  const [messages, setMessages] = useState([]);

  useEffect(() => {
  
    // Set up the Firebase Realtime Database listener
    const messagesRef = ref(getDatabase(), 'Scan_Results');

    const onMessageValue = onValue(messagesRef, (snapshot) => {
      const data = snapshot.val();
      const messageArray = data ? Object.values(data) : [];
      setMessages(messageArray);
    });

    // Clean up the listener when the component unmounts
    return () => {
      off(messagesRef, 'value', onMessageValue);
    };
  }, []);

  // Filter messages to show only values from the same hour
  const filteredMessages = messages.filter((message) => {

    const messageTime = new Date(message.timestamp);
    const currentHour = new Date().getHours();
    return messageTime.getHours() === currentHour;
  });
  const formatTimestamp = (timestamp) => {
    const date = new Date(timestamp);
    let hours = date.getHours();
    let minutes = date.getMinutes();
    let period = 'AM';

    if (hours >= 12) {
      period = 'PM';
      hours = hours === 12 ? 12 : hours - 12;
    }

    if (hours === 0) {
      hours = 12;
    }

    const formattedTime = `${hours}:${minutes.toString().padStart(2, '0')} ${period}`;
    return formattedTime;
  };
  return (
    <div style={{backgroundImage: 'linear-gradient(103.22deg, #db8eff -13.86%, #0aefe9 99.55%)',
    borderRadius: '15px',padding: '4px' }} className="container__DataTable "> 
     <div className="Horizon__DataTable" id="DataTable">
    
      <div className='Horizon__DataTable-content'>
      <h1 className="gradient__text">Scan Data</h1>
      <table className='ScanData_Table' style={{Align:'center'}}>
        
        <thead>
          <tr>
            <th style={{ padding: '10px' }}>File Name</th>
            <th style={{ paddingLeft: '25px' ,paddingRight:'25px',paddingTop:'10px',paddingBottom:'10px' }}>File Health</th>
            <th style={{ paddingLeft: '25px' ,paddingRight:'25px',paddingTop:'10px',paddingBottom:'10px' }}>Scan Time</th>
          </tr>
        </thead>
        <tbody>
          {filteredMessages.map((message, index) => (
            <tr key={index}>
              <td style={{ padding: '10px' }}>{message.file_name}</td>
              <td style={{ paddingLeft: '25px' ,paddingRight:'25px',paddingTop:'10px',paddingBottom:'10px' }}>{message.message}</td>
              <td style={{ paddingLeft: '25px' ,paddingRight:'25px',paddingTop:'10px',paddingBottom:'10px' }}>{formatTimestamp(message.timestamp)}</td>
            </tr>
          ))}
        </tbody>
      </table></div>
    </div>
    </div>
  );
};

export default DataTable;
//   return (
//     <div style={{ color: 'azure' }}>
//       <h3>Scan Data</h3>
//       <ul>
//       {filteredMessages.map((message, index) => (
//           <li key={index}>{message.file_name}</li>))}
//         {filteredMessages.map((message, index) => (
//           <li key={index}>{message.message}</li>
          
//         ))}
//       </ul>
//     </div>
//   );
// };

// export default DataTable;
//!!version2
// import React, { useEffect, useState } from 'react';
// import { initializeApp } from 'firebase/app';
// import { getDatabase, ref, onValue, off } from 'firebase/database';

// // Initialize Firebase
// const firebaseConfig = {

//     apiKey: "AIzaSyDzuobEE2QMZvNHViGGcSF_O3KwhYP_Ho4",
//     authDomain: "test-36b79.firebaseapp.com",
//     databaseURL: "https://test-36b79-default-rtdb.firebaseio.com",
//     projectId: "test-36b79",
//     storageBucket: "test-36b79.appspot.com",
//     messagingSenderId: "861846156224",
//     appId: "1:861846156224:web:c89f1bf833011492d08e25",
//     measurementId: "G-3EESY7N6LF"
//   };
  

// initializeApp(firebaseConfig);

// const DataTable = () => {
//   const [messages, setMessages] = useState([]);

//   useEffect(() => {
//     // Set up the Firebase Realtime Database listener
//     const messagesRef = ref(getDatabase(), 'messages');

//     const onMessageValue = onValue(messagesRef, (snapshot) => {
//       const data = snapshot.val();
//       const messageArray = data ? Object.values(data) : [];
//       setMessages(messageArray);
//     });

//     // Clean up the listener when the component unmounts
//     return () => {
//       off(messagesRef, 'value', onMessageValue);
//     };
//   }, []);

//   return (
//     <div  style={{ color: 'azure'}}>
//       <h1>Real-time data</h1>
//       <ul>
//         {messages.map((message, index) => (
//           <li key={index}>{message.message}</li>
//         ))}
//       </ul>
//     </div>
//   );
// };

// export default DataTable;
